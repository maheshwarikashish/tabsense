// activityLogger.js

let sessionStart = Date.now();
let lastActive = Date.now();
let focusTime = 0;
let isTabActive = true;

function handleFocus() {
  console.log("âœ… Tab focused");
  isTabActive = true;
  lastActive = Date.now();
}

function handleBlur() {
  console.log("ðŸš« Tab blurred");
  isTabActive = false;
  focusTime += Date.now() - lastActive;
}

window.addEventListener("focus", handleFocus);
window.addEventListener("blur", handleBlur);

let idleTimeout;
let idleStart = null;
let idleThreshold = 30000; // 30 seconds

function resetIdleTimer() {
  if (idleStart) {
    console.log("ðŸ’¡ User active again");
    idleStart = null;
    lastActive = Date.now();
  }
  clearTimeout(idleTimeout);
  idleTimeout = setTimeout(() => {
    idleStart = Date.now();
    console.log("ðŸ˜´ User is idle");
  }, idleThreshold);
}

// Listen for user actions
["mousemove", "keydown", "scroll", "click"].forEach((event) => {
  window.addEventListener(event, resetIdleTimer);
});

resetIdleTimer(); // start when page loads
window.addEventListener("beforeunload", () => {
  const endTime = Date.now();

  // Add current focus duration if tab is active
  if (isTabActive) {
    focusTime += endTime - lastActive;
  }

  const totalTime = endTime - sessionStart;
  const focusRatio = ((focusTime / totalTime) * 100).toFixed(2);

  console.log(`ðŸ§® Focus Ratio: ${focusRatio}%`);
});
export function getSessionData() {
  const now = Date.now();
  const totalTime = now - sessionStart;
  const currentFocus = isTabActive ? focusTime + (now - lastActive) : focusTime;
  const focusRatio = ((currentFocus / totalTime) * 100).toFixed(2);

  return {
    focusRatio,
    totalTime,
    timestamp: new Date().toISOString()
  };
}
